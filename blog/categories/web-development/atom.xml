<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Web Development | Louis Simoneau]]></title>
  <link href="http://lsimoneau.github.io/blog/categories/web-development/atom.xml" rel="self"/>
  <link href="http://lsimoneau.github.io/"/>
  <updated>2014-03-09T08:00:42+11:00</updated>
  <id>http://lsimoneau.github.io/</id>
  <author>
    <name><![CDATA[Louis Simoneau]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[PostgreSQL System Trigger Error with Rails]]></title>
    <link href="http://lsimoneau.github.io/2012/10/04/postgresql-system-trigger-error-with-rails/"/>
    <updated>2012-10-04T00:00:00+10:00</updated>
    <id>http://lsimoneau.github.io/2012/10/04/postgresql-system-trigger-error-with-rails</id>
    <content type="html"><![CDATA[<p><code>PG::Error: ERROR:  permission denied: "RI_ConstraintTrigger_50931" is a system trigger</code></p>

<p>Just ran into this issue and had a hard time locating a solution, so just throwing it up here so others might be able to find it faster.</p>

<p>You might see this error message if:</p>

<ul>
<li>You&#8217;re using PostgreSQL with Rails</li>
<li>You&#8217;re using foreign key constraints</li>
<li>You&#8217;re using <a href="https://github.com/bmabey/database_cleaner" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">database_cleaner</a> to tear down your test databases</li>
</ul>


<p>The problem is this: Postgres sets up foreign key constraints as &#8220;system triggers,&#8221; which can only be removed by a superuser. When database_cleaner tries to empty out your database between test runs, it tries to remove these keys, which causes the failure.</p>

<p>Currently there isn&#8217;t a &#8220;real&#8221; fix for this, but Sergey Potapov has bundled together the required hacks into a gem called <a href="https://github.com/greyblake/rails3_pg_deferred_constraints" onclick="javascript:_gaq.push(['_trackEvent','outbound-article','http://github.com']);">rails3_pg_deferred_constraints</a>. Pop it into your test group and you should be good to go.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Keeping Time on Frequently-suspended Virtual Machines]]></title>
    <link href="http://lsimoneau.github.io/2012/02/02/keeping-time-on-frequently-suspended-virtual-machines/"/>
    <updated>2012-02-02T00:00:00+11:00</updated>
    <id>http://lsimoneau.github.io/2012/02/02/keeping-time-on-frequently-suspended-virtual-machines</id>
    <content type="html"><![CDATA[<p>When everyone else&#8217;s git commits start showing up as &#8220;in the future,&#8221; you know something&#8217;s wrong.</p>

<p>It&#8217;s probably that your VM, having been suspended while your host OS was sleeping, has lost track of what time it is. You <em>could</em> <code>/etc/init.d/networking restart</code> every time you start work in the morning, but that&#8217;s a drag, and you&#8217;re likely to forget.</p>

<p>Instead, you want to use the NTP daemon to keep your clock in sync. By default, however, NTP will attempt to gradually and incrementally bring your clock back into sync, and will balk at large differences in time (like the 14 hours since you last opened your laptop). Fortunately, there&#8217;s a config setting for that.</p>

<p>Let&#8217;s do this thing:</p>

<pre><code>sudo apt-get install ntp
</code></pre>

<p>Then replace your <code>/etc/ntp.conf</code> file with the following:</p>

<pre><code>tinker panic 0

restrict 127.0.0.1
restrict default kod nomodify notrap

server 0.au.pool.ntp.org
server 1.au.pool.ntp.org
server 2.au.pool.ntp.org
server 3.au.pool.ntp.org

driftfile /var/lib/ntp/ntp.drift
</code></pre>

<p>Replace those <code>server</code> lines with NTP servers of your choosing.</p>

<p>The important line there is <code>tinker panic 0</code>, which is what tells NTP not to freak out if the difference in time between the local clock and the server is larger than it would normally be comfortable with. This line <strong>needs</strong> to come <strong>before</strong> all other config directives.</p>

<p>With that config in place, fire off a quick</p>

<pre><code>sudo /etc/init.d/ntp restart
</code></pre>

<p>and you&#8217;re in business. Next time you bring your VM back up from a deep slumber, hit <code>date</code> and you&#8217;ll be pleasantly surprised.</p>
]]></content>
  </entry>
  
</feed>
